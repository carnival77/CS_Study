# NoSQL

## 정의
No SQL. 비관계형 데이터베이스를 의미하며 테이블간의 관계를 정의하지 않고 스키마 없이 사용 가능하거나   
느슨한 스키마를 제공하는 저장소를 말한다.   


## 🤚 SQL(RDBMS) vs NoSQL 비교

### SQL 

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485668-b04f0296-0a27-48fd-b08c-43b20202477d.jpeg" width="70%">
</div>

<br><br>


- 데이터는 정해진 데이터 스키마에 따라 테이블에 저장  

<br>

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485667-c465cbbd-122c-49c8-a434-ce92bed63f66.jpeg" width="70%">
</div>

<br>

- 각 테이블은 각 데이터들을 구분할수있는 Field 와 데이터인 Record 로 이루어져있음
- 데이터는 관계를 통해 여러 테이블에 분산 - 데이터의 중복 방지
- **스키마를 준수하지 않은 레코드는 테이블에 추가할 수 없음**

<br>

### 장점 
- 명확하게 정의된 스키마, 데이터 무결성 보장
- 관계는 각 데이터를 중복없이 한번만 저장

<br>

### 단점
- 덜 유연함. 데이터 스키마를 사전에 계획하고 알려야 함. (나중에 수정하기 힘듬)
- 관계를 맺고 있어서 조인문이 많은 복잡한 쿼리가 만들어질 수 있음
- 대체로 수직적 확장만 가능함

<br>

### SQL 데이터베이스 사용이 더 좋을 때

- 관계를 맺고 있는 데이터가 자주 변경되는 애플리케이션의 경우
- 변경될 여지가 없고, 명확한 스키마가 사용자와 데이터에게 중요한 경우

<br><br>

<hr>


### NoSQL 

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485664-72622729-0203-453b-bdbc-e0e637fa3c69.jpeg" width="70%">
</div>

- 스키마 없음
- 테이블간 연관관계 없음
- 스키마가 없기 때문에 다른 구조의 데이터를 같은 컬렉션(sql의 테이블)에 추가 할 수 있다.
- RDBMS의 레코드를 Document 라고 부름.
    
    - JSON 과 비슷한 형태를 가지고 있음 

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485662-b5b68b87-f4da-4b5d-a8d3-955af8545b9f.jpeg" width="70%">
</div>
    
- 테이블과의 관계가 없으므로 Join 의 개념이 없으며 모든 정보를 한 테이블에 저장
- 데이터가 중복되기 때문에 모든 컬렉션에서 똑같이 데이터를 업데이트 해줘야함
- 분산형 구조

    > NoSQL은 기존 RDBMS와는 다르게 하나의 고성능 머신에 데이터를 저장하는 것이 아니라 일반적인 서버 수십 대를 연결해 데이터를 저장 및 처리하는 구조를 갖는다. 즉 분산형 구조를 통해 데이터를 여러 대의 서버에 분산해 저장하고 분산 시에 데이터를 상호 복제해 특정 서버에 장애가 발생했을 때에도 데이터 유실이나 서비스 중지가 없는 구조의 형태를 가진다.
    
    👉 RDBMS 가 클라이언트/서버 환경에 맞는 데이터 저장기술이라면, NoSQL은 클라우드 환경에 맞는 저장 기술이다.


- RDBMS의 한계를 극복하기 위해 만든 데이터 베이스

<br><br>

### 장점


 - 유연성
    - 유연한 스키마를 제공하여, 보다 빠르고 반복적인 개발이 가능. 
    - 유연한 데이터 모델은 NoSQL 데이터베이스를 반정형 및 데이터에 이상적으로 만들어 줌

 - 확장성
    - 일반적으로 고가의 강력한 서버를 추가하는 대신 분산형 하드웨어 클러스터를 이용해 확장하도록 설계
    
 - 고성능 
    - 관계형 데이터베이스를 통해 유사한 기능을 충족하려 할 때보다 뛰어난 성능을 낼 수 있음

 - 고기능성
    - NoSQL 데이터베이스는 각 데이터 모델에 맞추어 특별히 구축된 뛰어난 기능의 API와 데이터 유형을 제공

### 단점
- 유연성으로 인해 데이터 구조 결정을 미루게 될 수 있음
- 데이터 중복을 계속 업데이트 해야 함
- 데이터가 여러 컬렉션에 중복되어 있기 때문에 수정 시 모든 컬렉션에서 수행해야 함 (SQL에서는 중복 데이터가 없으므로 한번만 수행이 가능)

<br>


### NoSQL 데이터베이스 사용이 더 좋을 때

- 정확한 데이터 구조를 알 수 없거나 변경/확장 될 수 있는 경우
- 읽기를 자주 하지만, 데이터 변경은 자주 없는 경우
- 데이터베이스를 수평으로 확장해야 하는 경우 (막대한 양의 데이터를 다뤄야 하는 경우)

> 하지만 사례에 따라 정해진 정답이 있는 것은 아니며,    
> SQL을 선택해서 복잡한 JOIN문을 만들지 않도록 설계하여 단점을 없앨 수도 있고  
> NoSQL을 선택해서 중복 데이터를 줄이는 방법으로 설계해서 단점을 없앨 수도 있다.
> 
> 즉, 어떻게 설계하느냐가 가장 중요 

<br><br>


## NoSQL CAP 이론

분산형 구조는 일관성(Consistency), 가용성(Availability), 분산 허용(Partitioning Tolerance)의 3가지 특징을 가지고 있다.

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485728-914102bd-1187-4b52-ae50-18363cb19c82.png" width="60%">
</div>

<br>

### 일관성(Consistency)
 
- 동시성 또는 동일성이라고도 하며 다중 클라이언트에서 같은 시간에 조회하는 데이터는 항상 동일한 데이터임을 보증
- 일관성을 유지하기 위한 데이터의 동기화에는 두가지 방법이 사용된다.

    - 데이터의 저장 결과를 클라이언트로 응답하기 전에 모든 노드에 데이터를 저장하는 동기식 방법
        -  느린 응답시간을 보이지만 데이터의 정합성을 보장
        
        <br>
           
    - 메모리나 임시 파일에 기록하고 클라이언트에 먼저 응답한 다음, 특정 이벤트 또는 프로세스를 사용하여 노드로 데이터를 동기화하는 비동기식 방법
        - 빠른 응답시간을 보인다는 장점이 있지만, 쓰기 노드에 장애가 발생하였을 경우 데이터가 손실될 수 있음
    
<br>

### 가용성(Availability)

- 모든 클라이언트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야 함을 보증, 내고장성
- 내고장성을 가진 NoSQL 은 클러스터 내에서 몇 개의 노드가 망가지더라도 정상적인 서비스가 가능

<br>

### 네트워크 분할 허용성(Partition tolerance)
- 지역적으로 분할된 네트워크 환경에서 동작하는 시스템에서 두 지역 간의 네트워크가 단절되거나 네트워크 데이터의 유실이 일어나더라도 각 지역 내의 시스템은 정상적으로 동작해야 함

<br>


## NoSQL 의 분류  
`Key-Value Model`, `Document Model`, `Column Model`, `Graph Model` 로 분류할 수 있다.


### Key-Value Model


<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485722-86ac68c8-4046-4496-930d-9f3ff9211495.png" width="50%">
</div>

<br>

- 가장 기본적인 형태의 NoSQL 이며 키 하나로 데이터 하나를 저장하고 조회할 수 있는 단일 키-값 구조를 가짐
- 단순한 저장구조로 인하여 복잡한 조회 연산을 지원하지 않으며 고속 읽기와 쓰기에 최적화된 경우가 많음
- 하나의 서비스 요청에 다수의 데이터 조회 및 수정 연산이 발생하면 트랜잭션 처리가 불가능하여 데이터 정합성을 보장할 수 없다.
- ex) `Redis`, `HBase`, `Cassandra`

<br>

### Document Model

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485717-87d07d14-3834-4ff8-b550-c41541b6c00d.png" width="70%">
</div>

<br>

- 키-값 모델을 개념적으로 확장한 구조로 하나의 키에 하나의 구조화된 문서를 저장하고 조회
    - value에 Document라는 타입을 저장한다. Document는 구조화된 문서 데이터(XML, JSON, YAML 등)을 말한다
- 객체를 Document 형태로 바로 저장 가능하다는 점에서 객체지향에서의 객체와 유사
- 사용이 번거롭고 쿼리가 SQL과는 다르다는 단점이 있음
- ex) `MongoDB`

<br>

### Column Model

<div align="center">
  <img src="https://user-images.githubusercontent.com/65614734/143485773-792204b9-b453-483d-99ea-265b7b6c475d.png" width="50%">
</div>

<br>

- 하나의 키에 여러 개의 컬럼 이름과 컬럼 값의 쌍으로 이루어진 데이터를 저장하고 조회
- 저장의 기본 단위는 컬럼으로 컬럼은 컬럼 이름과 컬럼 값, 타임스탬프로 구성 
- 이러한 컬럼들의 집합이 로우(Row)이며, 로우키(Row key)는 각 로우를 유일하게 식별하는 값
- Row Key에 다수의 column & value가 들어감
- 쓰기와 읽기 중에 쓰기에 더 특화되어 있고, 빠른 응답속도를 제공
    - 읽기 연산 대비 쓰기 연산이 많은 서비스
    - 빠른 시간 안에 대량의 데이터를 입력하고 조회하는 서비스
    - 채팅 내용 저장, 실시간 분석을 위한 데이터 저장소 등의 서비스 구현에 적합
    

<br><br>
